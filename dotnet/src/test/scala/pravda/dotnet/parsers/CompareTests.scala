package pravda.dotnet

package parsers

import pravda.common.DiffUtils
import pravda.dotnet.data.Method
import pravda.dotnet.data.TablesData._
import pravda.dotnet.parsers.CIL._
import utest._

object CompareTests extends TestSuite {

  val tests = Tests {
    'compareParse - {
      val Right((_, cilData, methods, signatures)) = parsePeFile("compare.exe")

      DiffUtils.assertEqual(
        methods,
        List(
          Method(
            List(
              Nop,
              LdcI41,
              StLoc0,
              LdcI42,
              StLoc1,
              LdcI43,
              StLoc2,
              LdcI44,
              StLoc3,
              LdcI45,
              ConvI8,
              StLocS(4),
              LdcI46,
              ConvI8,
              StLocS(5),
              LdcI40,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Ceq,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Ceq,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              Ceq,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Ceq,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Ceq,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Ceq,
              StLocS(7),
              LdLocS(7),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Ceq,
              StLocS(8),
              LdLocS(8),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              Ceq,
              StLocS(9),
              LdLocS(9),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Ceq,
              StLocS(10),
              LdLocS(10),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Ceq,
              StLocS(11),
              LdLocS(11),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              LdLoc1,
              Clt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Clt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              CltUn,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Clt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Clt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Clt,
              LdcI40,
              Ceq,
              StLocS(12),
              LdLocS(12),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Clt,
              LdcI40,
              Ceq,
              StLocS(13),
              LdLocS(13),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              CltUn,
              LdcI40,
              Ceq,
              StLocS(14),
              LdLocS(14),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Clt,
              LdcI40,
              Ceq,
              StLocS(15),
              LdLocS(15),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Clt,
              LdcI40,
              Ceq,
              StLocS(16),
              LdLocS(16),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              LdLoc1,
              Cgt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Cgt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              CgtUn,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Cgt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Cgt,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Cgt,
              LdcI40,
              Ceq,
              StLocS(17),
              LdLocS(17),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Cgt,
              LdcI40,
              Ceq,
              StLocS(18),
              LdLocS(18),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              CgtUn,
              LdcI40,
              Ceq,
              StLocS(19),
              LdLocS(19),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Cgt,
              LdcI40,
              Ceq,
              StLocS(20),
              LdLocS(20),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Cgt,
              LdcI40,
              Ceq,
              StLocS(21),
              LdLocS(21),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              LdLoc1,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Ceq,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Ceq,
              LdcI40,
              Ceq,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(22),
              LdLocS(22),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(23),
              LdLocS(23),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              Ceq,
              LdcI40,
              Ceq,
              StLocS(24),
              LdLocS(24),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Ceq,
              LdcI40,
              Ceq,
              StLocS(25),
              LdLocS(25),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Ceq,
              LdcI40,
              Ceq,
              StLocS(26),
              LdLocS(26),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              LdLoc1,
              Cgt,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Cgt,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              CgtUn,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Cgt,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Cgt,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Cgt,
              StLocS(27),
              LdLocS(27),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Cgt,
              StLocS(28),
              LdLocS(28),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              CgtUn,
              StLocS(29),
              LdLocS(29),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Cgt,
              StLocS(30),
              LdLocS(30),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Cgt,
              StLocS(31),
              LdLocS(31),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              LdLoc1,
              Clt,
              StLocS(6),
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Clt,
              StLocS(6),
              LdLoc2,
              LdLoc3,
              CltUn,
              StLocS(6),
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Clt,
              StLocS(6),
              LdLocS(4),
              LdLocS(5),
              Clt,
              StLocS(6),
              LdLoc0,
              LdLoc1,
              Clt,
              StLocS(32),
              LdLocS(32),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc0,
              ConvI8,
              LdLoc2,
              ConvU8,
              Clt,
              StLocS(33),
              LdLocS(33),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              LdLoc3,
              CltUn,
              StLocS(34),
              LdLocS(34),
              BrFalseS(2),
              Nop,
              Nop,
              LdLoc2,
              ConvU8,
              LdLocS(4),
              Clt,
              StLocS(35),
              LdLocS(35),
              BrFalseS(2),
              Nop,
              Nop,
              LdLocS(4),
              LdLocS(5),
              Clt,
              StLocS(36),
              LdLocS(36),
              BrFalseS(2),
              Nop,
              Nop,
              Ret
            ),
            2,
            Some(16)
          ),
          Method(List(Nop, Ret), 0, None),
          Method(List(LdArg0, Call(MemberRefData(TypeRefData(6, "Object", "System"), ".ctor", 6)), Nop, Ret), 0, None)
        )
      )
    }
  }
}
